{% extends 'ads/base.html' %}
{% block title %}–í—Å–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —Ä–µ–∂–∏–º–æ–≤ -->
  <div class="mb-4">
    <a href="?view=received" class="btn {% if view_mode != 'sent' %}btn-primary{% else %}btn-outline-primary{% endif %}">–í—Ö–æ–¥—è—â–∏–µ</a>
    <a href="?view=sent" class="btn {% if view_mode == 'sent' %}btn-primary{% else %}btn-outline-primary{% endif %}">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ</a>
  </div>

  <!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
  <form method="get" class="mb-4">
    <input type="hidden" name="view" value="{{ view_mode }}">
    <div class="row g-2">
      <div class="col-md-4">
        <input type="text" name="user" value="{{ user_filter }}" class="form-control" placeholder="{% if view_mode == 'sent' %}–ü–æ–ª—É—á–∞—Ç–µ–ª—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è{% else %}–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endif %}">
      </div>
      <div class="col-md-4">
        <select name="status" class="form-select">
          <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
          <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>–û–∂–∏–¥–∞–µ—Ç</option>
          <option value="accepted" {% if status_filter == 'accepted' %}selected{% endif %}>–ü—Ä–∏–Ω—è—Ç–æ</option>
          <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</option>
        </select>
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-primary w-100">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
      </div>
    </div>
  </form>

  {% if view_mode == 'received' %}
    <h2>–í—Ö–æ–¥—è—â–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h2>
    {% for proposal in proposals %}
      <div class="card mb-3">
        <div class="card-body">
          <strong>{{ proposal.ad_sender.title }}</strong> ‚Üí –Ω–∞ <strong>{{ proposal.ad_receiver.title }}</strong><br>
          <small>–æ—Ç {{ proposal.ad_sender.user.username }}</small><br>
          üí¨ {{ proposal.comment }}<br>
          üïí –°—Ç–∞—Ç—É—Å: <strong>{{ proposal.get_status_display }}</strong>
          {% if proposal.status == 'pending' %}
            <div class="mt-2">
              <a href="{% url 'ads:accept_proposal' proposal.id %}" class="btn btn-sm btn-success">–ü—Ä–∏–Ω—è—Ç—å</a>
              <form action="{% url 'ads:reject_proposal' proposal.id %}" method="post" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
              </form>
            </div>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <p class="text-muted">–ù–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.</p>
    {% endfor %}

  {% elif view_mode == 'sent' %}
    <h2>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h2>
    {% for proposal in proposals %}
      <div class="card mb-3">
        <div class="card-body">
          –í—ã –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏: <strong>{{ proposal.ad_sender.title }}</strong><br>
          –ù–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ: <strong>{{ proposal.ad_receiver.title }}</strong><br>
          –ü–æ–ª—É—á–∞—Ç–µ–ª—å: {{ proposal.ad_receiver.user.username }}<br>
          üí¨ {{ proposal.comment }}<br>
          üïí –°—Ç–∞—Ç—É—Å: <strong>{{ proposal.get_status_display }}</strong>
        </div>
      </div>
    {% empty %}
      <p class="text-muted">–ù–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.</p>
    {% endfor %}
  {% endif %}

</div>
{% endblock %}